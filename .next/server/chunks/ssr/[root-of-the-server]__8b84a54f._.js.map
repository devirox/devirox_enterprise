{"version":3,"sources":["turbopack:///[project]/lib/prisma.ts","turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@babel+core@7.28.5_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","turbopack:///[project]/app/dashboard/admin/uploads/actions.ts","turbopack:///[project]/lib/cloudinary.ts","turbopack:///[project]/.next-internal/server/app/dashboard/admin/uploads/page/actions.js (server actions loader)"],"sourcesContent":["import type { PrismaClient as PrismaClientType } from '@prisma/client'\n\ntype PrismaClientConstructor = new () => PrismaClientType\n\nfunction createStubClientConstructor(): PrismaClientConstructor {\n  const createModelProxy = (model: string) =>\n    new Proxy(\n      {},\n      {\n        get(_target, property: string | symbol) {\n          if (typeof property === 'string') {\n            if (property === 'findMany') return async () => []\n            if (property === 'findUnique') return async () => null\n            if (property === 'deleteMany') return async () => ({ count: 0 })\n            return async () => {\n              throw new Error(`Prisma Client is not available in this environment. Attempted to call ${model}.${property}.`)\n            }\n          }\n          return undefined\n        }\n      }\n    )\n\n  const clientProxy = new Proxy(\n    {},\n    {\n      get(_target, property: string | symbol) {\n        if (typeof property === 'string') {\n          if (property === '$connect' || property === '$disconnect') {\n            return async () => undefined\n          }\n          if (property.startsWith('$')) {\n            return async () => {\n              throw new Error(`Prisma Client is not available in this environment. Attempted to call ${property}.`)\n            }\n          }\n          return createModelProxy(property)\n        }\n        return undefined\n      }\n    }\n  )\n\n  class PrismaClientStub {\n    constructor() {\n      return clientProxy as unknown as PrismaClientType\n    }\n  }\n\n  return PrismaClientStub as unknown as PrismaClientConstructor\n}\n\nlet PrismaClientCtor: PrismaClientConstructor\n\ntry {\n  // eslint-disable-next-line @typescript-eslint/no-var-requires\n  PrismaClientCtor = require('@prisma/client').PrismaClient as PrismaClientConstructor\n} catch (error) {\n  console.warn('Falling back to PrismaClient stub. Original error:', error)\n  PrismaClientCtor = createStubClientConstructor()\n}\n\ndeclare global {\n  // eslint-disable-next-line no-var\n  var prisma: PrismaClientType | undefined\n}\n\nexport const prisma: PrismaClientType = globalThis.prisma ?? new PrismaClientCtor()\n\nif (process.env.NODE_ENV !== 'production') globalThis.prisma = prisma\n\nexport default prisma\n","/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","import prisma from '@/lib/prisma'\nimport { uploadToCloudinary } from '@/lib/cloudinary'\n\nexport async function uploadImageAction(formData: FormData) {\n  'use server'\n  const title = String(formData.get('title') || '')\n  const folder = String(formData.get('folder') || '')\n  const imageUrl = formData.get('imageUrl') as unknown as string | null\n  const file = formData.get('file') as unknown as File | null\n\n  let uploadResult\n  if (file) {\n    uploadResult = await uploadToCloudinary(file, (file as any).name, folder || undefined)\n  } else if (imageUrl) {\n    uploadResult = await uploadToCloudinary(imageUrl, undefined, folder || undefined)\n  } else {\n    throw new Error('No file or imageUrl provided')\n  }\n\n  const record = await (prisma as any).imageAsset.create({ data: { title: title || null, publicId: uploadResult.publicId, url: uploadResult.url, folder: folder || null, isActive: true } })\n\n  const { redirect } = await import('next/navigation')\n  redirect('/dashboard/admin/uploads')\n}\n\nexport default uploadImageAction\n","// use global fetch available in Node 18+/Next.js runtime\n\ntype UploadResult = { publicId: string; url: string }\n\nconst CLOUD_NAME = process.env.CLOUDINARY_CLOUD_NAME\nconst API_KEY = process.env.CLOUDINARY_API_KEY\nconst API_SECRET = process.env.CLOUDINARY_API_SECRET\nconst UPLOAD_PRESET = process.env.CLOUDINARY_UPLOAD_PRESET\n\nfunction cloudinaryBase() {\n  if (CLOUD_NAME) return `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`\n  return null\n}\n\nexport async function uploadToCloudinary(input: File | Buffer | string, filename?: string, folder?: string): Promise<UploadResult> {\n  const url = cloudinaryBase()\n  if (!url) throw new Error('Cloudinary not configured (CLOUDINARY_CLOUD_NAME missing)')\n\n  const form = new (global as any).FormData()\n\n  if (typeof input === 'string') {\n    // Cloudinary can fetch remote URL\n    form.append('file', input)\n  } else {\n    // File or Buffer\n    form.append('file', input as any, filename || 'upload')\n  }\n\n  if (UPLOAD_PRESET) form.append('upload_preset', UPLOAD_PRESET)\n  if (folder) form.append('folder', folder)\n\n  // If API key/secret provided, use basic auth via query (not secure for client-side)\n  const uploadUrl = url\n\n  const res = await fetch(uploadUrl, {\n    method: 'POST',\n    body: form as any\n  })\n\n  if (!res.ok) {\n    const text = await res.text()\n    throw new Error(`Cloud upload failed: ${res.status} ${text}`)\n  }\n\n  const obj = await res.json()\n  return { publicId: obj.public_id || obj.publicId || obj.asset_id || '', url: obj.secure_url || obj.url }\n}\n\nexport default { uploadToCloudinary }\n","export {$$RSC_SERVER_ACTION_0 as '40df06fa25c2e867d11632d7baa9964431a0a7c338'} from 'ACTIONS_MODULE0'\n"],"names":["registerServerReference"],"mappings":"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","ignoreList":[1]}