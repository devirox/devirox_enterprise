{"version":3,"sources":["turbopack:///[project]/lib/prisma.ts","turbopack:///[project]/lib/auth/verify.ts","turbopack:///[project]/app/verify/page.tsx"],"sourcesContent":["import type { PrismaClient as PrismaClientType } from '@prisma/client'\n\ntype PrismaClientConstructor = new () => PrismaClientType\n\nfunction createStubClientConstructor(): PrismaClientConstructor {\n  const createModelProxy = (model: string) =>\n    new Proxy(\n      {},\n      {\n        get(_target, property: string | symbol) {\n          if (typeof property === 'string') {\n            if (property === 'findMany') return async () => []\n            if (property === 'findUnique') return async () => null\n            if (property === 'deleteMany') return async () => ({ count: 0 })\n            return async () => {\n              throw new Error(`Prisma Client is not available in this environment. Attempted to call ${model}.${property}.`)\n            }\n          }\n          return undefined\n        }\n      }\n    )\n\n  const clientProxy = new Proxy(\n    {},\n    {\n      get(_target, property: string | symbol) {\n        if (typeof property === 'string') {\n          if (property === '$connect' || property === '$disconnect') {\n            return async () => undefined\n          }\n          if (property.startsWith('$')) {\n            return async () => {\n              throw new Error(`Prisma Client is not available in this environment. Attempted to call ${property}.`)\n            }\n          }\n          return createModelProxy(property)\n        }\n        return undefined\n      }\n    }\n  )\n\n  class PrismaClientStub {\n    constructor() {\n      return clientProxy as unknown as PrismaClientType\n    }\n  }\n\n  return PrismaClientStub as unknown as PrismaClientConstructor\n}\n\nlet PrismaClientCtor: PrismaClientConstructor\n\ntry {\n  // eslint-disable-next-line @typescript-eslint/no-var-requires\n  PrismaClientCtor = require('@prisma/client').PrismaClient as PrismaClientConstructor\n} catch (error) {\n  console.warn('Falling back to PrismaClient stub. Original error:', error)\n  PrismaClientCtor = createStubClientConstructor()\n}\n\ndeclare global {\n  // eslint-disable-next-line no-var\n  var prisma: PrismaClientType | undefined\n}\n\nexport const prisma: PrismaClientType = globalThis.prisma ?? new PrismaClientCtor()\n\nif (process.env.NODE_ENV !== 'production') globalThis.prisma = prisma\n\nexport default prisma\n","import prisma from '@/lib/prisma'\n\nexport async function verifyToken({ token, email }: { token: string; email: string }) {\n  const record = await prisma.verificationToken.findUnique({ where: { token } as any })\n  if (!record || record.identifier !== email) {\n    throw new Error('Invalid or missing token')\n  }\n\n  const now = new Date()\n  if (record.expires < now) {\n    // delete expired token\n    await prisma.verificationToken.deleteMany({ where: { token } })\n    throw new Error('Token expired')\n  }\n\n  // mark user as approved and emailVerified\n  await prisma.user.update({ where: { email }, data: { isApproved: true, emailVerified: new Date() } })\n\n  // delete the token (single-use)\n  await prisma.verificationToken.deleteMany({ where: { token } })\n  return true\n}\n","import React from 'react'\nimport { verifyToken } from '@/lib/auth/verify'\n\nexport default async function VerifyPage({ searchParams }: { searchParams: { token?: string; email?: string } }) {\n  const { token, email } = searchParams || {}\n  if (!token || !email) {\n    return (\n      <main className=\"p-8\">\n        <h1 className=\"text-2xl font-bold\">Verification failed</h1>\n        <p className=\"mt-2\">Missing token or email.</p>\n      </main>\n    )\n  }\n\n  try {\n    await verifyToken({ token, email })\n    return (\n      <main className=\"p-8\">\n        <h1 className=\"text-2xl font-bold\">Verified</h1>\n        <p className=\"mt-2\">Your email has been verified. You can now <a href=\"/login\">sign in</a>.</p>\n      </main>\n    )\n  } catch (err: any) {\n    return (\n      <main className=\"p-8\">\n        <h1 className=\"text-2xl font-bold\">Verification failed</h1>\n        <p className=\"mt-2\">{err?.message || 'Invalid or expired token.'}</p>\n      </main>\n    )\n  }\n}\n"],"names":[],"mappings":"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"}